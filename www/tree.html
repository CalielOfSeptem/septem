<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<style>
	.vakata-context { 
		 z-index:999 !important; 
	} 
	</style>
	

	<link rel="stylesheet" href="jstree/dist/themes/default-dark/style.min.css" /> 
</head>
<body>
	<div id="clbk" class="demo"></div>
	<div id="evts" class="demo"></div>
<button>Select node 1</button>
	
	<button id="refresh_button">Refresh</button> <em></em>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
	
	<script src="jstree/dist/jstree.min.js"></script>
	
	<script>


	// data from callback
	$('#clbk').jstree({
		'core' : {
			"check_callback" : true,
			"themes": {
                "name": "default-dark",
                "dots": true,
                "icons": true
            },
			'data' : function (node, cb) {
				if(node.id === "#") {
					 //callback.call(this, ['Root 1', 'Root 2']);
					//cb([{"text" : "Root", "id" : "1", "children" : true}]);
					httpGetAsync("http://192.168.0.17:8090/match/123", cb);
				}
				else {
					httpGetAsync("http://192.168.0.17:8090/match/123", cb);//cb(["Child"]);
				}
			}
			
		},
		'plugins' : ['contextmenu', 'types'],
			'types' : {
				'#' : { /* options */ },
				'file' : { /* options */ },
				'directory' : { /* options */ }
				// etc...
			},
			'contextmenu' : {
                    "items": customMenub
		}
	});
	$("#clbk").jstree("set_theme", "default-dark"); 
	
	
	
	function strToJson(str) {
		eval("var x = " + str + ";");
		return JSON.stringify(x);
	}
	

	function customMenub(node)
	{
		
		var items = {
			'item1' : {
               "separator_before": false,
                "separator_after": false,
                "label": "Create",
                "action": function (obj) { 
                    $node2 = $("#clbk").jstree('create_node', $node2);
                    $("#clbk").jstree('edit', $node2);
                }
			},
			'item2' : {
				'label' : 'item2',
				'action' : function () { /* action */ }
			}
		}
		//alert(node.type);
		if (node.type === 'level_1') {
			delete items.item2;
		} else if (node.type === 'level_2') {
			delete items.item1;
		}

		return items;
	}
	
	function customMenu(node) {
		// The default set of all items
		//alert("custommenu");
		var items = {
			renameItem: { // The "rename" menu item
				label: "Rename",
				action: function () {}
			},
			deleteItem: { // The "delete" menu item
				label: "Delete",
				action: function () {}
			}
		};

		if ($(node).hasClass("folder")) {
			// Delete the "delete" menu item
			delete items.deleteItem;
		}

		return items;
	}
	
	function httpGetAsync(theUrl, callback)
	{
	//alert(this);
		var xmlHttp = new XMLHttpRequest();
		xmlHttp.onreadystatechange = function() { 
	
			if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
			{
				eval("var x = " + xmlHttp.responseText + ";");
				callback(x);
			}
		}
		xmlHttp.open("GET", theUrl, true); // true for asynchronous 
		xmlHttp.send(null);
	}
	
	function method()
	{			
			if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
			{
				eval("var x = " + xmlHttp.responseText + ";");
				//callback(x);
				//var instance = $('#clbk').jstree();
				//$("#clbk").jstree("set_theme", "default-dark"); 
				//stance.settings.core.data = x;
				//instance.refresh();
			}
	}
	
	function refresh_tree(theUrl)
	{
		//alert(this);
		var xmlHttp = new XMLHttpRequest();
		var instance = $('#clbk').jstree();
		instance.jstree("set_theme", "default-dark"); 
		xmlHttp.onreadystatechange = function() { 
	
			if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
			{
				
			}
		}
		xmlHttp.open("GET", theUrl, true); // true for asynchronous 
		xmlHttp.send(null);
		

	}
	

	// interaction and events
	$('#evts_button').on("click", function () {
	//alert(this);
		var instance = $('#evts').jstree(true);
		instance.deselect_all();
		instance.select_node('1');
	});
	
	$('#refresh_button').on("click", function () {
	alert(this);
	//var element = document.querySelector('.clbk');
	//alert(element);
		var instance = $('#clbk').jstree(true);
		instance.deselect_all();
		//instance.select_node('1');
		//refresh_tree("http://192.168.0.17:8090/match/123");
	});

	</script>
</body>
</html>
